<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<title>Liga Badminton â€“ Ultimate LIVE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:'Segoe UI',sans-serif;background:#f5f5f5;color:#333;}
nav{position:sticky;top:10px;z-index:100;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:12px 25px;background:linear-gradient(135deg,#C0C0C0,#808080,#FFFFFF);border-radius:15px;box-shadow:0 6px 20px rgba(0,0,0,0.25);text-align:center;transition:all 0.3s ease;}
nav:hover{box-shadow:0 8px 30px rgba(0,0,0,0.35);transform:translateY(-2px);}
nav h2{margin:0;font-weight:900;font-size:28px;display:flex;align-items:center;justify-content:center;}
.gradient-text{background:linear-gradient(135deg,#8e24aa,#f44336,#ffeb3b,#ff9800,#8e24aa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 2px 4px rgba(0,0,0,0.3);margin:0 8px;letter-spacing:1px;font-weight:900;transition:all 0.3s ease;}
nav h2:hover .gradient-text{text-shadow:0 4px 8px rgba(0,0,0,0.5);transform:scale(1.05);}
nav h2 span.emoji{margin:0 5px;display:inline-flex;align-items:center;}
nav div{margin-top:5px;font-size:15px;font-weight:600;color:#0000ff;line-height:1.2;text-shadow:0 2px 4px rgba(0,0,0,0.25);transition:all 0.3s ease;}
nav:hover div{text-shadow:0 3px 6px rgba(0,0,0,0.5);transform:scale(1.02);}
section{margin:20px auto;padding:20px;background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);max-width:950px;color:#333;}
table{width:100%;border-collapse:separate;border-spacing:0 8px;}
th,td{text-align:center;padding:10px;}
th{background:#42a5f580;color:#000;border:none;border-radius:8px;text-shadow:0 0 3px #fff;}
td{background:#f0f0f0;border:none;border-radius:8px;color:#333;}
input{width:60px;padding:6px;border-radius:6px;border:1px solid #aaa;text-align:center;background:#fff;color:#333;}
input:disabled{background:#eee;color:#999;}
input.positive{color:#00aa00;font-weight:bold;}
input.negative{color:#ff4444;font-weight:bold;}
input.zero{color:#333;}
button{padding:6px 12px;margin:2px;border-radius:6px;border:none;background:#42a5f5;color:white;cursor:pointer;box-shadow:0 0 10px rgba(66,165,245,0.8);}
button:hover{background:#1e88e5;box-shadow:0 0 15px rgba(66,165,245,1);}
#resetBtn{background:#ef5350;box-shadow:0 0 10px rgba(239,83,80,0.8);}
#adminSection{text-align:center;margin-top:10px;}
#passwordModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);justify-content:center;align-items:center;}
#passwordModal div{background:#fff;padding:20px;border-radius:8px;text-align:center;color:#333;box-shadow:0 0 15px rgba(0,0,0,0.2);}
.firstPlace td{background:#FFF8DC;font-weight:bold;}
.secondPlace td{background:#E0E0E0;font-weight:bold;}
@media(max-width:600px){th,td,input,button{font-size:12px;padding:5px;}}
@media print{nav{background:linear-gradient(135deg,#8e24aa,#f44336,#ffeb3b,#ff9800,#42a5f5)!important;color:#fff;box-shadow:none;-webkit-print-color-adjust:exact;}.gradient-text{background:linear-gradient(135deg,#8e24aa,#f44336,#ffeb3b,#ff9800,#42a5f5);-webkit-background-clip:text!important;-webkit-text-fill-color:transparent!important;text-shadow:0 0 1px rgba(0,0,0,0.1)!important;}}
</style>
</head>
<body>

<nav>
<h2>ğŸ¸ <span class="gradient-text">Liga JJM BC</span> ğŸ¸</h2>
<div>JarangÂ² Main Badminton ClubğŸ˜ğŸ˜‚</div>
</nav>

<section>
<h3>ğŸ† Jadual Kedudukan</h3>
<table id="markahTable">
<thead>
<tr><th>Rank</th><th>Pasukan</th><th>Main</th><th>Menang</th><th>Kalah</th><th>Jumlah Mata</th></tr>
</thead>
<tbody></tbody>
</table>
</section>

<section>
<h3>ğŸ”¥ Senarai Perlawanan</h3>
<table>
<thead>
<tr><th>Pasukan</th><th>Skor</th><th>Pasukan</th></tr>
</thead>
<tbody id="gameList"></tbody>
</table>

<div style="text-align:center; display:flex; justify-content:center; align-items:center; gap:10px; margin-top:10px; flex-wrap:wrap;">
<p id="infoText" style="margin:0;"></p>

<button onclick="showAdminModal()" title="Login sebagai Admin">ğŸ” Admin Login</button>

<a href="https://wa.me/60149236577" target="_blank" style="text-decoration:none;" title="Hubungi Admin WhatsApp">
<button style="background:#25D366; box-shadow:0 0 10px rgba(37,211,102,0.8);">
<img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" style="height:16px; vertical-align:middle; margin-right:5px;">
Ws Admin
</button></a>

<button onclick="tambahPair()" id="addBtn" style="display:none" title="Tambah Pasukan">â• Tambah</button>
<button onclick="buangPair()" id="delBtn" style="display:none" title="Buang Pasukan">â– Buang</button>
<button onclick="resetData()" id="resetBtn" style="display:none" title="Reset Semua Perlawanan">â™»ï¸ Reset</button>
</div>
</section>

<div id="passwordModal">
<div>
<p>Password admin:</p>
<input type="password" id="adminPwInput">
<button onclick="checkPassword()">Login</button>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
apiKey:"AIzaSyBRLCSzb3QahfPhLQu9WLIvBO9jovYm2y8",
databaseURL:"https://liga-badminton-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db=firebase.database();

let pairs=[],games=[],isAdmin=false;

db.ref("pairs").on("value",snap=>{
pairs=[...new Set(snap.val()||["Pasukan 1","Pasukan 2","Pasukan 3","Pasukan 4"])];
});
db.ref("games").on("value",snap=>{
if(snap.exists()){games=snap.val();}else{buatPerlawananRoundRobin();return;}
paparkanPerlawanan();
kiraMarkah();
});

function buatPerlawananRoundRobin(){
let t=[...pairs];if(t.length<2)return;if(t.length%2)t.push("BYE");
let r=t.length-1,h=t.length/2,a=t.slice(1),g=[];
for(let i=0;i<r;i++){
for(let j=0;j<h;j++){
let x=j?a[j-1]:t[0],y=a[a.length-j-1];
if(x!=="BYE"&&y!=="BYE"&&x!==y&&!g.some(p=> (p.a===x&&p.b===y)||(p.a===y&&p.b===x) ))
g.push({a:x,b:y,sa:"",sb:""});
}a.unshift(a.pop());
}
db.ref("games").set(g);
}

function kiraMarkah(){
let d={};pairs.forEach(p=>d[p]={main:0,menang:0,kalah:0,jumlah:0});
games.forEach(g=>{
if(g.sa===""||g.sb==="")return;
let sa=+g.sa,sb=+g.sb;
d[g.a].main++;d[g.b].main++;
d[g.a].jumlah+=sa-sb;d[g.b].jumlah+=sb-sa;
sa>sb?(d[g.a].menang++,d[g.b].kalah++):(d[g.b].menang++,d[g.a].kalah++);
});
let s=Object.entries(d).sort((a,b)=>b[1].menang-a[1].menang||b[1].jumlah-a[1].jumlah);
let tb=document.querySelector("#markahTable tbody");tb.innerHTML="";
s.forEach((e,i)=>{
  let rankDisplay = i === 0 ? "ğŸ¥‡" : i === 1 ? "ğŸ¥ˆ" : i + 1;
  tb.innerHTML += `<tr class="${i==0?"firstPlace":i==1?"secondPlace":""}">
    <td>${rankDisplay}</td>
    <td>${e[0]}</td>
    <td>${e[1].main}</td>
    <td>${e[1].menang}</td>
    <td>${e[1].kalah}</td>
    <td>${e[1].jumlah}</td>
  </tr>`;
});
}

function paparkanPerlawanan(){
let g=document.getElementById("gameList");
g.innerHTML="";
games.forEach((x,i)=>{
let saClass=x.sa===""?"zero":(+x.sa>+x.sb?"positive":(+x.sa<+x.sb?"negative":"zero"));
let sbClass=x.sb===""?"zero":(+x.sb>+x.sa?"positive":(+x.sb<+x.sa?"negative":"zero"));

g.innerHTML+=`<tr>
<td>${x.a}</td>
<td style="display:flex; justify-content:center; align-items:center; gap:6px;">
  <input ${!isAdmin?"disabled":""} class="${saClass}" value="${x.sa}" onchange="update(${i},'sa',this.value)" style="width:40px;">
  <span style="font-weight:bold;">ğŸ†š</span>
  <input ${!isAdmin?"disabled":""} class="${sbClass}" value="${x.sb}" onchange="update(${i},'sb',this.value)" style="width:40px;">
</td>
<td>${x.b}</td>
</tr>`;
});
}

function update(i,f,v){if(isAdmin){games[i][f]=v;db.ref("games").set(games);kiraMarkah();paparkanPerlawanan();}}
function showAdminModal() {
  passwordModal.style.display = "flex";
  adminPwInput.value = "";
  adminPwInput.focus();

  // Tambah state baru supaya back button boleh tutup modal
  window.history.pushState({modalOpen:true}, null, window.location.href);
}
function checkPassword(){
  if(adminPwInput.value==="260895"){
    passwordModal.style.display="none";
    isAdmin=true;
    infoText.innerText="Admin aktif";
    addBtn.style.display=delBtn.style.display=resetBtn.style.display="inline-block";
    paparkanPerlawanan();
  } else {
    alert("âŒ Password salah!");
    adminPwInput.value="";
    adminPwInput.focus();
  }
}
function tambahPair(){let n=prompt("Nama pasukan");if(n){pairs.push(n);db.ref("pairs").set(pairs);db.ref("games").remove();}}
function buangPair(){let n=prompt("Nama Pasukan untuk buang:");if(!n)return;let idx=pairs.findIndex(p=>p.trim().toLowerCase()===n.trim().toLowerCase());if(idx>-1){pairs.splice(idx,1);db.ref("pairs").set(pairs);db.ref("games").remove();}else{alert("âŒ Pasukan tidak dijumpai!");}}
function resetData(){if(confirm("Reset semua perlawanan?"))db.ref("games").remove();}

window.addEventListener("popstate", function (event) {
  if(passwordModal.style.display === "flex") {
    // Modal sedang aktif â†’ tutup modal sahaja
    passwordModal.style.display = "none";
    infoText.innerText = ""; // reset mesej admin
    adminPwInput.value = "";
  }
});
</script>

</body>
</html>