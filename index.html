<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<title>Liga Badminton ‚Äì Ultimate LIVE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:'Segoe UI',sans-serif;background:#f0f2f5;color:#333;}
h2,h3{margin:0 0 10px 0;color:#1e88e5;}
section{margin:20px auto;padding:20px;background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);max-width:950px;}
nav{display:flex;align-items:center;justify-content:center;padding:15px;background:linear-gradient(90deg,#1e88e5,#42a5f5);color:white;position:sticky;top:0;z-index:100;}
nav img{height:45px;margin-right:15px;filter:drop-shadow(0 0 2px #000);position:absolute;left:20px;}
table{width:100%;border-collapse:separate;border-spacing:0 8px;}
th,td{text-align:center;padding:10px;}
th{background:#e3f2fd;color:#1e88e5;border:none;border-radius:8px;}
td{background:#f9f9f9;border:none;border-radius:8px;}
input{width:60px;padding:6px;border-radius:6px;border:1px solid #ccc;}
input:disabled{background:#eee;}
button{padding:6px 12px;margin:2px;border-radius:6px;border:none;background:#1e88e5;color:white;cursor:pointer;}
button:hover{background:#1565c0;}
#resetBtn{background:#d32f2f;}
#adminSection{text-align:center;margin-top:10px;}
.firstPlace td:nth-child(2){font-weight:bold;color:#d32f2f;}
@media(max-width:600px){th,td,input,button{font-size:12px;padding:5px;}}
</style>
</head>
<body>

<nav>
<img src="https://upload.wikimedia.org/wikipedia/commons/7/7a/Badminton_icon.svg">
<h2>Liga Badminton</h2>
</nav>

<section>
<h3>üèÜ Jadual Kedudukan</h3>
<button onclick="cetak()">üñ®Ô∏è Cetak Jadual</button>
<table id="markahTable">
<thead>
<tr><th>#</th><th>Pasukan</th><th>Main</th><th>Menang</th><th>Kalah</th><th>Mata</th><th>Point Diff</th></tr>
</thead>
<tbody></tbody>
</table>
</section>

<section>
<h3>üéÆ Senarai Perlawanan</h3>
<table id="gameTable">
<thead>
<tr><th>Pasukan</th><th>Skor</th><th>Skor</th><th>Pasukan</th></tr>
</thead>
<tbody id="gameList"></tbody>
</table>

<div id="adminSection">
<button onclick="adminLogin()">üîê Admin Login</button>
<button onclick="tambahPair()" id="addBtn" style="display:none;">‚ûï Tambah Pasukan</button>
<button onclick="buangPair()" id="delBtn" style="display:none;">‚ûñ Buang Pasukan</button>
<button onclick="resetData()" id="resetBtn" style="display:none;">‚ôªÔ∏è Reset Semua Data</button>
</div>
</section>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ===== FIREBASE CONFIG =====
const firebaseConfig = {
  apiKey: "AIzaSyBRLCSzb3QahfPhLQu9WLIvBO9jovYm2y8",
  authDomain: "liga-badminton.firebaseapp.com",
  databaseURL: "https://liga-badminton-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "liga-badminton",
  storageBucket: "liga-badminton.firebasestorage.app",
  messagingSenderId: "647551116865",
  appId: "1:647551116865:web:f01bda84467dd634ab08c0",
  measurementId: "G-5CM12B9M42"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== DATA =====
let pairs=[], games=[], isAdmin=false;

// ===== INIT =====
db.ref('pairs').on('value', snap=>{pairs = snap.val() || ["Pasukan 1","Pasukan 2","Pasukan 3","Pasukan 4"]; buatPerlawanan(); paparkanPerlawanan(); kiraMarkah();});
db.ref('games').on('value', snap=>{games = snap.val() || []; paparkanPerlawanan(); kiraMarkah();});

// ===== BUAH PERLAWANAN =====
function buatPerlawanan(){
  games=[];
  for(let i=0;i<pairs.length;i++){
    for(let j=i+1;j<pairs.length;j++){
      games.push({a:pairs[i],b:pairs[j],sa:"",sb:""});
    }
  }
  db.ref('games').set(games);
  db.ref('pairs').set(pairs);
}

// ===== KIRA MARKAH & AUTO SORT =====
function kiraMarkah(){
  let data={};
  pairs.forEach(p=>data[p]={main:0,menang:0,kalah:0,mata:0,pointDiff:0});
  games.forEach(g=>{
    if(g.sa===""||g.sb==="") return;
    let sa=parseInt(g.sa), sb=parseInt(g.sb);
    data[g.a].main++; data[g.b].main++;
    data[g.a].pointDiff += sa-sb;
    data[g.b].pointDiff += sb-sa;
    if(sa>sb){data[g.a].menang++;data[g.a].mata+=2;data[g.b].kalah++;}
    else if(sb>sa){data[g.b].menang++;data[g.b].mata+=2;data[g.a].kalah++;}
  });

  // Auto sort berdasarkan mata + point diff
  let sorted = Object.entries(data).sort((a,b)=>{
    if(b[1].mata!==a[1].mata) return b[1].mata-a[1].mata;
    return b[1].pointDiff-a[1].pointDiff;
  });

  let tb=document.querySelector("#markahTable tbody"); tb.innerHTML="";
  sorted.forEach((d,i)=>{
    let m=d[1]; let cls=(i===0)?"firstPlace":"";
    tb.innerHTML+=`<tr class="${cls}"><td>${i+1}</td><td>${d[0]}</td><td>${m.main}</td><td>${m.menang}</td><td>${m.kalah}</td><td>${m.mata}</td><td>${m.pointDiff}</td></tr>`;
  });
}

// ===== PAPAR PERLAWANAN =====
function paparkanPerlawanan(){
  // Auto susun ikut pairs order
  let list=document.getElementById("gameList"); list.innerHTML="";
  games.forEach((g,i)=>{
    list.innerHTML+=`<tr>
<td>${g.a}</td>
<td><input value="${g.sa}" ${!isAdmin?"disabled":""} onchange="update(${i},'a',this.value)"></td>
<td><input value="${g.sb}" ${!isAdmin?"disabled":""} onchange="update(${i},'b',this.value)"></td>
<td>${g.b}</td>
</tr>`;
  });
}

// ===== UPDATE =====
function update(i,type,val){
  if(!isAdmin) return;
  if(type==="a") games[i].sa = val; else games[i].sb = val;
  db.ref('games').set(games);
}

// ===== TAMBAH / BUANG PASUKAN =====
function tambahPair(){if(!isAdmin)return; let nama=prompt("Nama Pasukan baru:"); if(nama){pairs.push(nama); buatPerlawanan();}}
function buangPair(){if(!isAdmin)return; let nama=prompt("Nama Pasukan untuk buang:"); let idx=pairs.indexOf(nama); if(idx>-1){pairs.splice(idx,1); buatPerlawanan();}}

// ===== RESET DATA =====
function resetData(){
  if(!isAdmin) return;
  if(!confirm("‚ö†Ô∏è Pasti nak reset semua skor?")) return;
  games.forEach(g=>{g.sa=""; g.sb="";});
  db.ref('games').set(games);
  kiraMarkah();
  alert("‚úÖ Semua skor telah di-reset!");
}

// ===== ADMIN LOGIN =====
function adminLogin(){
  const pw=prompt("Masukkan password admin:");
  if(pw==="badminton123"){
    isAdmin=true;
    document.getElementById("infoText").innerText="Admin aktif. Boleh edit.";
    document.getElementById("addBtn").style.display="inline-block";
    document.getElementById("delBtn").style.display="inline-block";
    document.getElementById("resetBtn").style.display="inline-block";
    paparkanPerlawanan();
  } else alert("Password salah!");
}

// ===== CETAK =====
function cetak(){window.print();}
</script>
</body>
</html>