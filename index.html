<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<title>Liga Badminton â€“ Ultimate LIVE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:'Segoe UI',sans-serif;background:#f0f2f5;color:#333;}
h2 {margin:0 0 10px 0;color:#000000; font-weight:bold;}
h3{margin:0 0 10px 0;color:#0d47a1; font-weight:bold;}
section{margin:20px auto;padding:20px;background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);max-width:950px;}
nav{display:flex;align-items:center;justify-content:center;padding:15px;background:linear-gradient(90deg,#FAFAD2,#FFFFFF);color:white;position:sticky;top:0;z-index:100;}
nav img{height:45px;margin-right:15px;filter:drop-shadow(0 0 2px #000);position:absolute;left:20px;}
table{width:100%;border-collapse:separate;border-spacing:0 8px;}
th,td{text-align:center;padding:10px;}
th{background:#e3f2fd;color:#0d47a1;border:none;border-radius:8px;}
td{background:#f9f9f9;border:none;border-radius:8px;}
input{width:60px;padding:6px;border-radius:6px;border:1px solid #ccc; text-align:center;}
input:disabled{background:#eee;color:#333;}
button{padding:6px 12px;margin:2px;border-radius:6px;border:none;background:#1e88e5;color:white;cursor:pointer;}
button:hover{background:#1565c0;}
#resetBtn{background:#d32f2f;}
#adminSection{text-align:center;margin-top:10px;}
#passwordModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;}
#passwordModal div{background:#fff;padding:20px;border-radius:8px;text-align:center;}

/* WARNA TOP 1 & 2 */
.firstPlace td{background:#FFF8DC;font-weight:bold;} /* Emas lembut */
.secondPlace td{background:#F0F0F0;font-weight:bold;} /* Silver lembut */

/* WARNA JUMLAH MATA BERDASARKAN NILAI */
td.jumlahMataPositif{background:#D0F0C0;font-weight:bold;} /* Hijau lembut */
td.jumlahMataNegatif{background:#F0D0D0;font-weight:bold;} /* Merah lembut */
td.jumlahMataZero{background:#fff;} /* Sifar, putih */
</style>
</head>
<body>

<nav>
<h2>ğŸ¸Liga by MikğŸ˜ğŸ˜‚</h2>
</nav>

<section>
<h3>ğŸ† Jadual Kedudukan ğŸ¥‡</h3>
<button onclick="cetak()">ğŸ–¨ï¸ Cetak Jadual</button>
<table id="markahTable">
<thead>
<tr>
<th>Rank</th>
<th>Pasukan</th>
<th>Main</th>
<th>Menang</th>
<th>Kalah</th>
<th>Jumlah Mata</th>
</tr>
</thead>
<tbody></tbody>
</table>
</section>

<section>
<h3>ğŸ”¥ Senarai Perlawanan ğŸ†š</h3>
<table id="gameTable">
<thead>
<tr>
<th>Pasukan</th>
<th>Skor</th>
<th>Skor</th>
<th>Pasukan</th>
</tr>
</thead>
<tbody id="gameList"></tbody>
</table>

<div id="adminSection">
<p id="infoText"></p>
<button onclick="showAdminModal()">ğŸ” Admin Login</button>
<button onclick="tambahPair()" id="addBtn" style="display:none;">â• Tambah Pasukan</button>
<button onclick="buangPair()" id="delBtn" style="display:none;">â– Buang Pasukan</button>
<button onclick="resetData()" id="resetBtn" style="display:none;">â™»ï¸ Reset Semua Data</button>
</div>
</section>

<!-- PASSWORD MODAL -->
<div id="passwordModal">
  <div>
    <p>Masukkan password admin:</p>
    <input type="password" id="adminPwInput" placeholder="Password">
    <button onclick="checkPassword()">Login</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ===== FIREBASE CONFIG =====
const firebaseConfig = {
  apiKey: "AIzaSyBRLCSzb3QahfPhLQu9WLIvBO9jovYm2y8",
  authDomain: "liga-badminton.firebaseapp.com",
  databaseURL: "https://liga-badminton-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "liga-badminton",
  storageBucket: "liga-badminton.firebasestorage.app",
  messagingSenderId: "647551116865",
  appId: "1:647551116865:web:f01bda84467dd634ab08c0",
  measurementId: "G-5CM12B9M42"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== DATA =====
let pairs=[], games=[], isAdmin=false;

// ===== INIT =====
db.ref('pairs').on('value', snap=>{
    pairs = snap.val() || ["Pasukan 1","Pasukan 2","Pasukan 3","Pasukan 4"];
    paparkanPerlawanan();
    kiraMarkah();
});

db.ref('games').on('value', snap=>{
    games = snap.val() || [];
    paparkanPerlawanan();
    kiraMarkah();
});

// ===== BUAH PERLAWANAN =====
function buatPerlawanan(){
  let newGames = [];
  for(let i=0;i<pairs.length;i++){
    for(let j=i+1;j<pairs.length;j++){
      let existing = games.find(g => 
        (g.a === pairs[i] && g.b === pairs[j]) || 
        (g.a === pairs[j] && g.b === pairs[i])
      );
      if(existing){
        newGames.push(existing);
      } else {
        newGames.push({a:pairs[i], b:pairs[j], sa:"", sb:""});
      }
    }
  }
  games = newGames; 
  db.ref('games').set(games);
  db.ref('pairs').set(pairs);
}

// ===== KIRA MARKAH =====
function kiraMarkah(){
  let data={};
  pairs.forEach(p=>data[p]={main:0,menang:0,kalah:0,jumlahMata:0});
  games.forEach(g=>{
    if(g.sa===""||g.sb==="") return;
    let sa=parseInt(g.sa), sb=parseInt(g.sb);
    data[g.a].main++; data[g.b].main++;
    let diff = sa - sb;
    data[g.a].jumlahMata += diff;
    data[g.b].jumlahMata -= diff;
    if(sa>sb){data[g.a].menang++; data[g.b].kalah++;}
    else if(sb>sa){data[g.b].menang++; data[g.a].kalah++;}
  });

  let sorted = Object.entries(data).sort((a,b)=>{
    if(b[1].menang!==a[1].menang) return b[1].menang-a[1].menang;
    return b[1].jumlahMata - a[1].jumlahMata;
  });

  let tb=document.querySelector("#markahTable tbody"); tb.innerHTML="";
  sorted.forEach((d,i)=>{
    let cls="";
    if(i===0) cls="firstPlace";
    else if(i===1) cls="secondPlace";
    let m=d[1];
    let mataClass = "jumlahMataZero";
    if(m.jumlahMata>0) mataClass="jumlahMataPositif";
    else if(m.jumlahMata<0) mataClass="jumlahMataNegatif";

    tb.innerHTML+=`<tr class="${cls}">
<td>${i+1}</td>
<td>${d[0]}</td>
<td>${m.main}</td>
<td>${m.menang}</td>
<td>${m.kalah}</td>
<td class="${mataClass}">${m.jumlahMata}</td>
</tr>`;
  });
}

// ===== PAPAR PERLAWANAN =====
function paparkanPerlawanan(){
  let list=document.getElementById("gameList"); list.innerHTML="";
  games.forEach((g,i)=>{
    list.innerHTML+=`<tr>
<td>${g.a}</td>
<td><input class="${getClass(g.sa)}" value="${g.sa}" ${!isAdmin?"disabled":""} onchange="update(${i},'a',this.value)"></td>
<td><input class="${getClass(g.sb)}" value="${g.sb}" ${!isAdmin?"disabled":""} onchange="update(${i},'b',this.value)"></td>
<td>${g.b}</td>
</tr>`;
  });
}

// ===== CLASS WARNA SKOR =====
function getClass(val){
  if(val==="") return "zero";
  let n = parseInt(val);
  if(n>0) return "positive";
  if(n<0) return "negative";
  return "zero";
}

// ===== UPDATE =====
function update(i,type,val){
  if(!isAdmin) return;
  if(type==="a") games[i].sa = val; else games[i].sb = val;
  db.ref('games').set(games);
  paparkanPerlawanan();
}

// ===== TAMBAH / BUANG PASUKAN =====
function tambahPair(){
  if(!isAdmin) return;
  let nama = prompt("Nama Pasukan baru:");
  if(nama){
    pairs.push(nama);
    buatPerlawanan();
  }
}

function buangPair(){
  if(!isAdmin) return;
  let nama = prompt("Nama Pasukan untuk buang:");
  if(nama){
    let idx = pairs.findIndex(p => p.toLowerCase() === nama.toLowerCase());
    if(idx>-1){
      pairs.splice(idx,1);
      buatPerlawanan();
    } else alert("Pasukan tidak dijumpai!");
  }
}

// ===== RESET DATA =====
function resetData(){
  if(!isAdmin) return;
  if(!confirm("âš ï¸ Pasti nak reset semua skor?")) return;
  games.forEach(g=>{g.sa=""; g.sb="";});
  db.ref('games').set(games);
  kiraMarkah();
  alert("âœ… Semua skor telah di-reset!");
}

// ===== ADMIN MODAL =====
function showAdminModal(){
  const modal = document.getElementById("passwordModal");
  modal.style.display="flex";
  const pwInput = document.getElementById("adminPwInput");
  pwInput.value="";
  setTimeout(()=>pwInput.focus(), 100);
}

function checkPassword(){
  const pw = document.getElementById("adminPwInput").value;
  if(pw==="mik95"){
    document.getElementById("passwordModal").style.display="none";
    isAdmin=true;
    document.getElementById("infoText").innerText="Admin aktif. Boleh edit.";
    document.getElementById("addBtn").style.display="inline-block";
    document.getElementById("delBtn").style.display="inline-block";
    document.getElementById("resetBtn").style.display="inline-block";
    paparkanPerlawanan();
    setTimeout(focusFirstInput,100);
  } else alert("Password salah!");
}

// ===== FOCUS INPUT PERTAMA =====
function focusFirstInput(){
  const firstInput = document.querySelector("#gameList input:not([disabled])");
  if(firstInput) firstInput.focus();
}

// ===== AUTO-FOCUS INPUT BILA SENTUH =====
document.addEventListener("touchstart", function(e){
  if(!isAdmin) return;
  const target = e.target;
  if(target.tagName === "INPUT" && !target.disabled){
    e.stopPropagation();
    target.focus({preventScroll:false});
  }
}, {passive:false});

// ===== AUTO-FOCUS INPUT KOSONG =====
document.addEventListener("click", function(e){
  if(!isAdmin) return;
  const inputs = Array.from(document.querySelectorAll("#gameList input:not([disabled])"));
  const firstEmpty = inputs.find(i => i.value==="");
  if(firstEmpty) firstEmpty.focus();
});

// ===== ENTER PINDAH KE INPUT BERIKUTNYA =====
document.addEventListener("keydown", function(e){
  if(!isAdmin) return;
  if(e.key === "Enter"){
    e.preventDefault();
    const inputs = Array.from(document.querySelectorAll("#gameList input:not([disabled])"));
    const idx = inputs.indexOf(document.activeElement);
    if(idx > -1 && idx < inputs.length - 1){
      const next = inputs[idx + 1];
      next.focus();
      next.scrollIntoView({behavior:"smooth", block:"center"});
    }
  }
});

// ===== CETAK =====
function cetak(){window.print();}
</script>
</body>
</html>