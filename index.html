<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<title>Liga Badminton ‚Äì Ultimate LIVE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* ===== BODY ===== */
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:#f5f5f5;
  color:#333;
  overflow-x:hidden;
}

/* ===== BANNER ===== */
#banner{
  width:100%;
  aspect-ratio:16/9;
  background-image:url("banner.jpg");
  background-size:cover;
  background-position:center;
  position:relative;
  overflow:hidden;
  min-height:200px;
  max-height:400px;
}
#banner::before{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(0,0,0,0.7));
  z-index:1;
}
#banner::after{
  content:"";
  position:absolute;
  inset:0;
  background:radial-gradient(circle at center, rgba(255,255,255,0.08), transparent 60%);
  z-index:2;
}
#banner .shimmer{
  position:absolute;
  top:0;
  left:-100%;
  width:50%;
  height:100%;
  background:linear-gradient(120deg, rgba(255,255,255,0), rgba(255,255,255,0.2), rgba(255,255,255,0));
  animation:shimmer 3s infinite;
  z-index:3;
}
@keyframes shimmer{
  0%{left:-50%;}
  100%{left:100%;}
}

/* ===== NAV ===== */
nav{
  width:90%;
  max-width:950px;
  margin:20px auto;
  padding:14px 20px;
  background:linear-gradient(135deg,#C0C0C0,#808080,#fff);
  border-radius:16px;
  text-align:center;
  transition:.3s;
}
nav.sticky{
  position:sticky;
  top:10px;
  z-index:100;
}
nav h2{
  margin:0;
  font-size:28px;
  font-weight:900;
  display:flex;
  align-items:center;
  justify-content:center;
}
.gradient-text{
  background:linear-gradient(135deg,#8e24aa,#f44336,#ffeb3b,#ff9800,#8e24aa);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow:0 2px 4px rgba(0,0,0,0.3);
  margin:0 8px;
  letter-spacing:1px;
  font-weight:900;
}
nav div{
  margin-top:5px;
  font-size:15px;
  font-weight:600;
  color:#0000ff;
}

/* ===== SECTION ===== */
section{
  max-width:950px;
  margin:20px auto;
  padding:20px;
  background:#fff;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
  color:#333;
}

/* ===== TABLE RESPONSIVE FIX ===== */
section table{
  display:table;       /* jadual standard */
  margin:0 auto;       /* center di desktop */
  border-collapse:separate;
  border-spacing:0 8px;
  max-width:100%;
  overflow-x:auto;     /* responsive bila sempit */
  table-layout: fixed; /* kolum sama rata */
}

th, td{
  text-align:center;
  padding:10px;
  white-space: nowrap;       /* jangan pecahkan baris */
  overflow: hidden;          /* sembunyi overflow */
  text-overflow: ellipsis;   /* tunjuk ... bila panjang */
}

th{
  background:#42a5f580;
  color:#000;
  border:none;
  border-radius:8px;
  text-shadow:0 0 3px #fff;
}

td{
  background:#f0f0f0;
  border:none;
  border-radius:8px;
  color:#333;
}

.firstPlace td{background:#FFF8DC;font-weight:bold;}
.secondPlace td{background:#E0E0E0;font-weight:bold;}

/* ===== INPUT SCORE FIX ===== */
input{
  width:40px;       /* cukup kecil untuk satu baris */
  padding:4px;
  border-radius:6px;
  border:1px solid #aaa;
  text-align:center;
  background:#fff;
  color:#333;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
input:disabled{background:#eee;color:#999;}
input.positive{color:#00aa00;font-weight:bold;}
input.negative{color:red;font-weight:bold;}
input.zero{color:#333;}
button{
  padding:6px 12px;
  margin:2px;
  border-radius:6px;
  border:none;
  background:#42a5f5;
  color:white;
  cursor:pointer;
  box-shadow:0 0 10px rgba(66,165,245,0.8);
}
button:hover{
  background:#1e88e5;
  box-shadow:0 0 15px rgba(66,165,245,1);
}
#resetBtn{background:#ef5350;box-shadow:0 0 10px rgba(239,83,80,0.8);}

/* ===== PASSWORD MODAL ===== */
#passwordModal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.4);
  justify-content:center;
  align-items:center;
}
#passwordModal div{
  background:#fff;
  padding:20px;
  border-radius:8px;
  text-align:center;
  color:#333;
  box-shadow:0 0 15px rgba(0,0,0,0.2);
}

/* ===== MEDIA MOBILE ===== */
@media(max-width:600px){
  #banner{min-height:180px;}
  nav{width:95%;margin:10px auto 20px;padding:10px 12px;}
  nav h2{font-size:20px;}
  section{margin:15px 10px;padding:15px;}
  table, th, td, input, button{font-size:12px;padding:6px;}
}

/* ===== PRINT SAFE ===== */
@media print{
  #banner{display:none;}
  nav{box-shadow:none;}
}
</style>
</head>
<body>

<!-- BANNER -->
<div id="banner">
  <div class="shimmer"></div>
</div>

<!-- NAV -->
<nav id="mainNav">
<h2>üè∏ <span class="gradient-text">Liga JJM BC</span> üè∏</h2>
<div>Official League ¬∑ Competitive ¬∑ Fair Play</div>
</nav>

<!-- JADUAL -->
<section>
<h3>üèÜ Jadual Kedudukan</h3>
<table id="markahTable">
<thead>
<tr><th>Rank</th><th>Pasukan</th><th>Main</th><th>Menang</th><th>Kalah</th><th>Jumlah Mata</th></tr>
</thead>
<tbody></tbody>
</table>
</section>

<section>
<h3>üî• Senarai Perlawanan</h3>
<table>
<thead>
<tr><th>No.</th><th>Pasukan</th><th>Skor</th><th>Pasukan</th></tr>
</thead>
<tbody id="gameList"></tbody>
</table>

<div style="text-align:center; display:flex; justify-content:center; align-items:center; gap:10px; margin-top:10px; flex-wrap:wrap;">
<p id="infoText" style="margin:0;"></p>
<button onclick="showAdminModal()" title="Login sebagai Admin">üîê Admin Login</button>
<a href="https://wa.me/60149236577" target="_blank" style="text-decoration:none;">
<button style="background:#25D366; box-shadow:0 0 10px rgba(37,211,102,0.8);">
<img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" style="height:16px; vertical-align:middle; margin-right:5px;">Ws Admin
</button></a>
<button onclick="tambahPair()" id="addBtn" style="display:none">‚ûï Tambah</button>
<button onclick="buangPair()" id="delBtn" style="display:none">‚ûñ Buang</button>
<button onclick="resetData()" id="resetBtn" style="display:none">‚ôªÔ∏è Reset</button>
</div>
</section>

<!-- PASSWORD MODAL -->
<div id="passwordModal">
<div>
<p>Password admin:</p>
<input type="password" id="adminPwInput">
<button onclick="checkPassword()">Login</button>
</div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ===== FIREBASE =====
firebase.initializeApp({
apiKey:"AIzaSyBRLCSzb3QahfPhLQu9WLIvBO9jovYm2y8",
databaseURL:"https://liga-badminton-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db=firebase.database();

// ===== DATA & ADMIN =====
let pairs=[],games=[],isAdmin=false;

// ===== LOAD PAIRS =====
db.ref("pairs").on("value",snap=>{
  pairs=[...new Set(snap.val()||["Pasukan 1","Pasukan 2","Pasukan 3","Pasukan 4"])];
});

// ===== LOAD GAMES =====
db.ref("games").on("value",snap=>{
  if(snap.exists()){games=snap.val();}else{buatPerlawananRoundRobin(); return;}
  paparkanPerlawanan();
  kiraMarkah();
});

// ===== ROUND ROBIN =====
function buatPerlawananRoundRobin(){
  let t=[...pairs]; if(t.length<2)return; if(t.length%2)t.push("BYE");
  let r=t.length-1,h=t.length/2,a=t.slice(1),g=[];
  for(let i=0;i<r;i++){
    for(let j=0;j<h;j++){
      let x=j?a[j-1]:t[0],y=a[a.length-j-1];
      if(x!=="BYE"&&y!=="BYE"&&x!==y&&!g.some(p=> (p.a===x&&p.b===y)||(p.a===y&&p.b===x) ))
        g.push({a:x,b:y,sa:"",sb:""});
    }
    a.unshift(a.pop());
  }
  db.ref("games").set(g);
}

// ===== KIRA MARKAH =====
function kiraMarkah(){
  let d={}; pairs.forEach(p=>d[p]={main:0,menang:0,kalah:0,jumlah:0});
  games.forEach(g=>{
    if(g.sa===""||g.sb==="")return;
    let sa=+g.sa,sb=+g.sb;
    d[g.a].main++;d[g.b].main++;
    d[g.a].jumlah+=sa-sb; d[g.b].jumlah+=sb-sa;
    sa>sb?(d[g.a].menang++,d[g.b].kalah++):(d[g.b].menang++,d[g.a].kalah++);
  });
  let s=Object.entries(d).sort((a,b)=>b[1].menang-a[1].menang||b[1].jumlah-a[1].jumlah);
  let tb=document.querySelector("#markahTable tbody"); tb.innerHTML="";
  s.forEach((e,i)=>{
    let rankDisplay=i===0?"ü•á":i===1?"ü•à":i+1;
    tb.innerHTML+=`<tr class="${i==0?"firstPlace":i==1?"secondPlace":""}">
    <td>${rankDisplay}</td><td>${e[0]}</td><td>${e[1].main}</td><td>${e[1].menang}</td><td>${e[1].kalah}</td><td>${e[1].jumlah}</td>
    </tr>`;
  });
}

// ===== PAPARKAN PERLAWANAN =====
function paparkanPerlawanan(){
  let g=document.getElementById("gameList");
  g.innerHTML="";
  games.forEach((x,i)=>{
    let saClass=x.sa===""?"zero":(+x.sa>+x.sb?"positive":(+x.sa<+x.sb?"negative":"zero"));
    let sbClass=x.sb===""?"zero":(+x.sb>+x.sa?"positive":(+x.sb<+x.sa?"negative":"zero"));
    g.innerHTML+=`<tr>
      <td>${i+1}</td>
      <td>${x.a}</td>
      <td style="display:flex; justify-content:center; align-items:center; gap:6px;">
        <input ${!isAdmin?"disabled":""} class="${saClass}" value="${x.sa}" onchange="update(${i},'sa',this.value)">
        <span style="font-weight:bold;">üÜö</span>
        <input ${!isAdmin?"disabled":""} class="${sbClass}" value="${x.sb}" onchange="update(${i},'sb',this.value)">
      </td>
      <td>${x.b}</td>
    </tr>`;
  });
}

// ===== UPDATE SCORE =====
function update(i,f,v){if(isAdmin){games[i][f]=v; db.ref("games").set(games); kiraMarkah(); paparkanPerlawanan();}}

// ===== ADMIN MODAL =====
function showAdminModal(){
  passwordModal.style.display="flex";
  adminPwInput.value="";
  adminPwInput.focus();
  window.history.pushState({modalOpen:true}, null, window.location.href);
}
function checkPassword(){
  if(adminPwInput.value==="260895"){
    passwordModal.style.display="none";
    isAdmin=true;
    infoText.innerText="Admin aktif";
    addBtn.style.display=delBtn.style.display=resetBtn.style.display="inline-block";
    paparkanPerlawanan();
  } else {
    alert("‚ùå Password salah!");
    adminPwInput.value="";
    adminPwInput.focus();
  }
}

// ===== TAMBAH / BUANG / RESET =====
function tambahPair(){let n=prompt("Nama pasukan");if(n){pairs.push(n); db.ref("pairs").set(pairs); db.ref("games").remove();}}
function buangPair(){let n=prompt("Nama Pasukan untuk buang:");if(!n)return; let idx=pairs.findIndex(p=>p.trim().toLowerCase()===n.trim().toLowerCase()); if(idx>-1){pairs.splice(idx,1); db.ref("pairs").set(pairs); db.ref("games").remove();}else{alert("‚ùå Pasukan tidak dijumpai!");}}
function resetData(){if(confirm("Reset semua perlawanan?"))db.ref("games").remove();}

// ===== POPSTATE MODAL =====
window.addEventListener("popstate",function(event){
  if(passwordModal.style.display==="flex"){
    passwordModal.style.display="none";
    infoText.innerText="";
    adminPwInput.value="";
  }
});

// ===== NAV STICKY & BANNER PARALLAX =====
const nav=document.getElementById("mainNav");
const banner=document.getElementById("banner");
window.addEventListener("scroll",()=>{
  if(window.scrollY>banner.offsetHeight) nav.classList.add("sticky");
  else nav.classList.remove("sticky");
  banner.style.backgroundPositionY=window.scrollY*0.5+"px";
});
</script>

</body>
</html>